#include <cmath>
#include <eigen3/Eigen/Dense>

// Due to the nonlinear nature of the wheeled leg's kinematic model, the Jacobian matrix derived
// from its linearized kinematic equations becomes highly complex and verbose. Furthermore, since
// leg length varies, the Jacobian matrix also changes dynamically, making conventional LQR
// operations impractical. Therefore, calculations are first performed in MATLAB to obtain all gain
// matrices across the entire leg length range. Subsequently, a bivariate function of the left
// and right leg lengths is fitted to derive the gain matrix K.

namespace rmcs_core::controller::lqr {

class LqrCalculator {
public:
    LqrCalculator() = default;

    auto update(double l_l, double l_r) -> Eigen::Matrix<double, 4, 10> {
        calculate_fit_gain(l_l, l_r);
        return gain_;
    }

private:
    void calculate_fit_gain(double l_l, double l_r) {
        double K_result[40];

        double K_result_tmp;
        double b_K_result_tmp;
        double c_K_result_tmp;
        double d_K_result_tmp;
        double e_K_result_tmp;
        double f_K_result_tmp;
        double t2;
        double t3;
        double t4;
        double t5;
        double t6;
        double t7;
        /*     This function was generated by the Symbolic Math Toolbox version 24.2.
         */
        /*     2026-01-19 23:59:32 */
        t2 = l_l * l_l;
        t3 = std::pow(l_l, 3.0);
        t5 = l_r * l_r;
        t6 = std::pow(l_r, 3.0);
        t4 = t2 * t2;
        t7 = t5 * t5;
        K_result_tmp = l_l * l_r;
        b_K_result_tmp = l_l * t5;
        c_K_result_tmp = l_l * t6;
        d_K_result_tmp = l_r * t2;
        e_K_result_tmp = l_r * t3;
        f_K_result_tmp = t2 * t5;
        K_result[0] =
            ((((((l_l * 49.519066094841527 - l_r * 264.64687470180331) + t2 * 99.452877456856243)
                - t3 * 1107.179794403276)
               + t4 * 1237.6537352291259)
              + t5 * 1023.277655259573)
             + ((((t6 * -983.266843751636 - t7 * 252.25747351809451)
                  - K_result_tmp * 295.76210498572442)
                 - b_K_result_tmp * 2355.6271941424029)
                + c_K_result_tmp * 3746.923048388433))
            + (((d_K_result_tmp * 2865.1105821277388 - e_K_result_tmp * 1716.2352595057371)
                - f_K_result_tmp * 1806.8754403979481)
               + 15.900988036830091);
        K_result[1] =
            (((((l_l * -143.60853008303431 - l_r * 76.577529041723878) + t2 * 656.85046062467666)
               - t3 * 842.09297000827712)
              - t4 * 32.76964572047001)
             + ((((t5 * 834.25533479864612 - t6 * 2368.1241198739731) + t7 * 1915.778721879132)
                 - K_result_tmp * 644.29035571669613)
                + b_K_result_tmp * 1884.455621992498))
            + ((((c_K_result_tmp * -38.317955165453853 - d_K_result_tmp * 288.90240271970362)
                 + e_K_result_tmp * 2207.1694551630708)
                - f_K_result_tmp * 2823.3307327260482)
               + 16.371189276639019);
        K_result[2] =
            (((((l_l * -97.844014952553238 + l_r * 378.89581426555532) - t2 * 3.2709323635840342)
               - t3 * 617.54531952903278)
              + t4 * 1587.6914459852469)
             + (((((t5 * -3192.383141148433 + t6 * 8643.5016180517468) - t7 * 6858.5379856925456)
                  + K_result_tmp * 1215.8171078840321)
                 - b_K_result_tmp * 5116.7565361133811)
                + c_K_result_tmp * 468.02132002607561))
            + (((d_K_result_tmp * 1822.110648684868 - e_K_result_tmp * 5531.0110808088057)
                + f_K_result_tmp * 6330.6342246015874)
               + 23.918447993158551);
        K_result[3] =
            ((((((l_l * 346.73534170236547 - l_r * 61.162969453871128) - t2 * 2349.440418123213)
                + t3 * 6376.9835107582576)
               - t4 * 5700.0575049241206)
              + t5 * 236.79479788310971)
             + ((((t6 * -1624.9251344998779 + t7 * 2201.8983295157)
                  + K_result_tmp * 109.1319860299308)
                 + b_K_result_tmp * 3459.4266148232141)
                - c_K_result_tmp * 4126.827233021615))
            + (((d_K_result_tmp * -3454.3777854229438 + e_K_result_tmp * 2670.930990837684)
                + f_K_result_tmp * 963.163050643568)
               + 23.856340045205862);
        K_result[4] =
            ((((((l_l * 10.358543016163781 - l_r * 203.5005190393093) + t2 * 77.322396566930934)
                - t3 * 534.43329728971435)
               + t4 * 551.78736549994528)
              + t5 * 809.48036773883371)
             + (((((t6 * -1096.6801521517809 + t7 * 333.607780639757)
                   - K_result_tmp * 103.1587125717415)
                  - b_K_result_tmp * 1238.7424777305059)
                 + c_K_result_tmp * 1985.963425665808)
                + d_K_result_tmp * 1302.772593072503))
            + ((e_K_result_tmp * -694.89934496015758 - f_K_result_tmp * 941.56357617693993)
               + 13.69625723986436);
        K_result[5] =
            (((((l_l * -66.640041023853186 - l_r * 141.47011617717121) + t2 * 150.59964643868221)
               - t3 * 68.51003645798)
              - t4 * 227.6211902207628)
             + (((((t5 * 921.76947545449275 - t6 * 2275.2452174080072) + t7 * 1852.854117749418)
                  - K_result_tmp * 207.02288529783721)
                 + b_K_result_tmp * 547.88315957204441)
                + c_K_result_tmp * 313.02286196382079))
            + (((d_K_result_tmp * 38.009318060403963 + e_K_result_tmp * 786.65440847261709)
                - f_K_result_tmp * 1329.615475193938)
               + 14.6845396412346);
        K_result[6] =
            ((((((l_l * -17.382379082981291 + l_r * 191.83433091723029) - t2 * 215.38248243992419)
                + t3 * 177.04185746057911)
               + t4 * 452.87712648183128)
              - t5 * 1979.00131627843)
             + (((((t6 * 5670.0460946420853 - t7 * 4746.17358236347)
                   + K_result_tmp * 798.05813369076827)
                  - b_K_result_tmp * 3247.4314296435468)
                 + c_K_result_tmp * 601.27494988667547)
                + d_K_result_tmp * 857.500856843406))
            + ((e_K_result_tmp * -3074.645335299082 + f_K_result_tmp * 3794.5698038129)
               + 24.769647992705309);
        K_result[7] =
            ((((((l_l * 576.15348930080586 - l_r * 487.76939670822492) - t2 * 1893.6926319332761)
                + t3 * 3681.5449393308159)
               - t4 * 2816.6765021749479)
              + t5 * 3090.264111200559)
             + (((((t6 * -8407.85151129691 + t7 * 8002.5217822476279)
                   - K_result_tmp * 2108.2855913523831)
                  + b_K_result_tmp * 5840.5504568379029)
                 - c_K_result_tmp * 5036.24707424001)
                + d_K_result_tmp * 1193.6117313315069))
            + ((e_K_result_tmp * -217.37287189235431 - f_K_result_tmp * 1939.0760868151449)
               + 30.237336006835161);
        K_result[8] =
            (((((l_l * -4.9310648643240711 + l_r * 7.2002264945658059) + t2 * 56.541139543005222)
               - t3 * 102.5320921260893)
              + t4 * 26.27002527512958)
             + ((((t5 * 50.068639129019552 - t6 * 200.98443862514611) + t7 * 166.1267154593283)
                 - K_result_tmp * 114.2926111207355)
                + b_K_result_tmp * 277.88339705788911))
            + ((((c_K_result_tmp * -28.049826104012091 + d_K_result_tmp * 47.182490609015133)
                 + e_K_result_tmp * 194.55326847625531)
                - f_K_result_tmp * 380.25992676832033)
               - 1.030633894714478);
        K_result[9] =
            (((((l_l * -5.0710009122425461 + l_r * 2.6087176730532828) - t2 * 26.10498657983155)
               + t3 * 145.76721162582751)
              - t4 * 152.43837950316191)
             + ((((t5 * -8.0709031232571888 - t6 * 61.067919012609217) + t7 * 119.5131965706356)
                 + K_result_tmp * 41.566927163698153)
                + b_K_result_tmp * 142.75388407411839))
            + ((((c_K_result_tmp * -246.33121589791989 - d_K_result_tmp * 246.5650211952194)
                 + e_K_result_tmp * 152.39762579184031)
                + f_K_result_tmp * 145.09575109945391)
               + 1.0715692326760511);
        K_result[10] =
            (((((l_l * 36.282243998885193 - l_r * 42.736359961147407) - t2 * 134.57305471180271)
               + t3 * 135.76272734464609)
              - t4 * 63.080334582434567)
             + ((((t5 * 153.9990008140889 + t6 * 5.2197575556166971) - t7 * 310.97844675008218)
                 - K_result_tmp * 37.957816081050083)
                - b_K_result_tmp * 645.94605036131293))
            + ((((c_K_result_tmp * 1026.4867885180111 + d_K_result_tmp * 579.75897072585519)
                 - e_K_result_tmp * 300.01225094583879)
                - f_K_result_tmp * 419.3268494407335)
               - 1.343725561213682);
        K_result[11] =
            ((((((l_l * 50.308991746733767 - l_r * 42.088168791831322) - t2 * 167.9521291036682)
                + t3 * 147.86587729762459)
               + t4 * 49.125374064513913)
              + t5 * 171.97186944647)
             + ((((t6 * -294.74943355780908 + t7 * 211.6763639699939)
                  + K_result_tmp * 6.8727777660254219)
                 - b_K_result_tmp * 234.02410438551649)
                + c_K_result_tmp * 142.19120834845069))
            + (((d_K_result_tmp * 317.23125017640132 - e_K_result_tmp * 467.73969646015257)
                + f_K_result_tmp * 128.8736972561571)
               + 1.221908704316141);
        K_result[12] =
            (((((l_l * -0.43202559927386192 + l_r * 0.93803408263641763) + t2 * 23.607116009271479)
               - t3 * 38.824180630565913)
              - t4 * 0.32985508226492821)
             + ((((t5 * 52.800897882197383 - t6 * 180.39639471996321) + t7 * 155.0680099600124)
                 - K_result_tmp * 77.970231172436769)
                + b_K_result_tmp * 195.34719940933039))
            + ((((c_K_result_tmp * -43.711863873056 + d_K_result_tmp * 30.090161482807051)
                 + e_K_result_tmp * 110.6512271136605)
                - f_K_result_tmp * 228.69006124297439)
               - 0.436882415295074);
        K_result[13] =
            (((((l_l * -0.39877026474984828 - l_r * 2.102000934947367) - t2 * 29.817933341206331)
               + t3 * 94.000592870016021)
              - t4 * 80.942110508246131)
             + ((((t5 * 17.1715754475731 - t6 * 86.7487985872154) + t7 * 112.80495582302861)
                 + K_result_tmp * 24.7703413840776)
                + b_K_result_tmp * 57.078733547244923))
            + ((((c_K_result_tmp * -114.8656757646461 - d_K_result_tmp * 94.834802564094659)
                 + e_K_result_tmp * 40.30789843738642)
                + f_K_result_tmp * 69.846040449244541)
               + 0.57678686077621544);
        K_result[14] =
            ((((((l_l * 41.01714688375553 - l_r * 41.740439088847211) - t2 * 134.0165738647942)
                + t3 * 152.15407358304611)
               - t4 * 77.631416308602311)
              + t5 * 169.50036791429241)
             + ((((t6 * -131.02195559427651 - t7 * 117.6264132202827)
                  - K_result_tmp * 59.34665458780011)
                 - b_K_result_tmp * 407.1482346494368)
                + c_K_result_tmp * 722.92324002860767))
            + (((d_K_result_tmp * 452.26498436810181 - e_K_result_tmp * 230.8871877635589)
                - f_K_result_tmp * 352.24463818778008)
               - 0.73253334243048862);
        K_result[15] =
            (((((l_l * 53.20780754797925 - l_r * 59.363970356947632) - t2 * 56.741579275110738)
               - t3 * 59.125893770778063)
              + t4 * 140.4423314862585)
             + (((((t5 * 399.685870960481 - t6 * 1055.4816716720329) + t7 * 993.77240053326977)
                  - K_result_tmp * 280.11459619488261)
                 + b_K_result_tmp * 608.686408048281)
                - c_K_result_tmp * 534.19642558508349))
            + (((d_K_result_tmp * 346.9310960540945 - e_K_result_tmp * 240.2883599970055)
                - f_K_result_tmp * 226.46361185602419)
               + 1.168728749491823);
        K_result[16] =
            (((((l_l * 11.71972683002242 - l_r * 126.87142463921) - t2 * 73.646496070906039)
               - t3 * 5.1831939756143024)
              + t4 * 125.97561603422059)
             + ((((t5 * 200.532465328053 + t6 * 299.4401806851692) - t7 * 618.256090284853)
                 + K_result_tmp * 189.38416508910791)
                - b_K_result_tmp * 1214.622066777335))
            + ((((c_K_result_tmp * 1018.5690855414171 + d_K_result_tmp * 444.1479800549875)
                 - e_K_result_tmp * 577.54019833923269)
                + f_K_result_tmp * 354.74738960072727)
               + 2.880316436994236);
        K_result[17] =
            (((((l_l * -16.01687326095627 - l_r * 31.17209782525941) + t2 * 68.353368980049353)
               - t3 * 79.657700428563857)
              - t4 * 42.980493838949137)
             + ((((t5 * 237.80812859490371 - t6 * 498.43661415478158) + t7 * 294.5933925236248)
                 - K_result_tmp * 177.22445950336839)
                + b_K_result_tmp * 408.33392276148072))
            + ((((c_K_result_tmp * 83.376925162558152 + d_K_result_tmp * 13.27478528759312)
                 + e_K_result_tmp * 414.98285182467231)
                - f_K_result_tmp * 686.57475645659724)
               + 3.4401540343306758);
        K_result[18] =
            (((((l_l * -43.709720515444488 + l_r * 393.82610533556812) - t2 * 266.68184468524419)
               + t3 * 838.24841844184073)
              - t4 * 429.42581454015033)
             + (((((t5 * -3067.44921170092 + t6 * 7650.62377132923) - t7 * 5856.5509642053639)
                  + K_result_tmp * 1149.4480724340131)
                 - b_K_result_tmp * 2034.8252778743331)
                - c_K_result_tmp * 1385.288317518226))
            + (((d_K_result_tmp * -1471.326502745718 - e_K_result_tmp * 1010.378770914998)
                + f_K_result_tmp * 4588.4212273993817)
               + 32.289415910184253);
        K_result[19] =
            ((((((l_l * 246.94947250910911 - l_r * 172.80197916402381) - t2 * 1015.58091952831)
                + t3 * 1671.5787677020851)
               - t4 * 1168.1174111382211)
              + t5 * 154.45950854878919)
             + ((((t6 * 744.889689120951 - t7 * 1525.1144624647891)
                  + K_result_tmp * 228.11665881923381)
                 - b_K_result_tmp * 1449.14937107582)
                + c_K_result_tmp * 2546.3764006341162))
            + (((d_K_result_tmp * 563.74347478178186 + e_K_result_tmp * 60.4695447475869)
                - f_K_result_tmp * 1157.7491510298159)
               - 2.545814116656036);
        K_result[20] =
            (((((l_l * -0.023223509853613981 - l_r * 6.5635779314468019) + t2 * 1.128577109523099)
               - t3 * 18.16450235434268)
              + t4 * 23.32388944869983)
             + ((((t5 * 5.6532418086495344 + t6 * 27.88689967980461) - t7 * 42.909497284496616)
                 + K_result_tmp * 5.7128580483588234)
                - b_K_result_tmp * 87.214080251262772))
            + ((((c_K_result_tmp * 78.417535247498066 + d_K_result_tmp * 57.249764314084231)
                 - e_K_result_tmp * 53.37310163295372)
                + f_K_result_tmp * 8.8684223183067559)
               + 0.381593736642001);
        K_result[21] =
            (((((l_l * -0.81101760566251568 - l_r * 3.8133722424750678) - t2 * 0.26401393871443041)
               + t3 * 9.9088294525670779)
              - t4 * 22.484918999011249)
             + ((((t5 * 27.65949052736654 - t6 * 56.9605417835658) + t7 * 36.109541359064742)
                 - K_result_tmp * 16.9861695236361)
                + b_K_result_tmp * 20.572638323789018))
            + ((((c_K_result_tmp * 33.923466245675108 + d_K_result_tmp * 10.60039299949762)
                 + e_K_result_tmp * 44.173594071078149)
                - f_K_result_tmp * 81.474705141723163)
               + 0.41851458577514777);
        K_result[22] =
            (((((l_l * -0.859924635086052 + l_r * 23.3867212640602) - t2 * 19.954656301622769)
               + t3 * 45.166391583956091)
              - t4 * 4.7711413736387334)
             + ((((t5 * -142.46824266969909 + t6 * 340.19874205057272) - t7 * 223.09499644210081)
                 + K_result_tmp * 57.848301015665143)
                - b_K_result_tmp * 140.3500870510145))
            + ((((c_K_result_tmp * -133.45552213558221 - d_K_result_tmp * 27.398962553527149)
                 - e_K_result_tmp * 165.26862007713291)
                + f_K_result_tmp * 356.39030582177151)
               + 1.136938441957398);
        K_result[23] =
            (((((l_l * 25.5467754669838 - l_r * 11.53039060762849) - t2 * 94.819296726406222)
               + t3 * 182.22319590961729)
              - t4 * 145.6811041000332)
             + ((((t5 * 49.894308154300127 - t6 * 115.98612817156879) + t7 * 74.874780122016972)
                 - K_result_tmp * 27.631266508415891)
                + b_K_result_tmp * 79.693725093069489))
            + ((((c_K_result_tmp * 25.01269019934249 - d_K_result_tmp * 2.8296726892568569)
                 + e_K_result_tmp * 71.2220134291065)
                - f_K_result_tmp * 130.06363407940711)
               + 0.056580538236626947);
        K_result[24] =
            (((((l_l * -7.507923807477499 - l_r * 47.1166073834091) + t2 * 10.609183847451559)
               - t3 * 266.8715875045138)
              + t4 * 445.92045409782958)
             + ((((t5 * -138.66856730072519 + t6 * 714.8166512354735) - t7 * 717.88430896844932)
                 + K_result_tmp * 305.36977833759732)
                - b_K_result_tmp * 1290.1053940014231))
            + ((((c_K_result_tmp * 795.13732224673527 + d_K_result_tmp * 563.46305906966563)
                 - e_K_result_tmp * 1024.8457594211461)
                + f_K_result_tmp * 672.41645240069522)
               + 3.768869583068311);
        K_result[25] =
            (((((l_l * -96.5181386929551 - l_r * 13.29649407893276) + t2 * 296.91137344618278)
               - t3 * 492.02077209854048)
              + t4 * 258.47396521460638)
             + ((((t5 * 64.41551158197602 + t6 * 116.7904093052677) - t7 * 299.53651415115871)
                 - K_result_tmp * 82.217207855106835)
                - b_K_result_tmp * 571.88933368168887))
            + ((((c_K_result_tmp * 890.06726979519453 + d_K_result_tmp * 570.63485502912943)
                 - e_K_result_tmp * 170.323622829347)
                - f_K_result_tmp * 468.472627641117)
               + 2.672247540619805);
        K_result[26] =
            ((((((l_l * -319.00139678526261 + l_r * 322.51636869379888) + t2 * 1281.5527044375519)
                - t3 * 2311.5125789206832)
               + t4 * 1993.574700206831)
              - t5 * 1044.332181315531)
             + ((((t6 * -1.7918399485947849 + t7 * 1992.929250143161)
                  - K_result_tmp * 490.87684038932031)
                 + b_K_result_tmp * 3668.6169654858149)
                - c_K_result_tmp * 5930.3772134101646))
            + (((d_K_result_tmp * -637.32449153956736 - e_K_result_tmp * 1111.1476465127009)
                + f_K_result_tmp * 2400.8298830774779)
               + 1.784851464616279);
        K_result[27] =
            ((((((l_l * 216.9577621182199 + l_r * 165.24949179860539) - t2 * 1864.3618153585389)
                + t3 * 4655.7469807600628)
               - t4 * 4112.06601451245)
              - t5 * 505.81034264548231)
             + (((((t6 * 1269.1369867703561 - t7 * 1326.40938672467)
                   - K_result_tmp * 5.4108660341742638)
                  - b_K_result_tmp * 1147.335547410969)
                 + c_K_result_tmp * 1890.0830855029651)
                + d_K_result_tmp * 653.95338161024029))
            + ((e_K_result_tmp * 5.084398864909816 - f_K_result_tmp * 917.35945255922047)
               + 30.628295146352809);
        K_result[28] =
            (((((l_l * -0.93660812157978057 - l_r * 3.9207061529273979) + t2 * 6.3893228756827174)
               - t3 * 32.640909299313648)
              + t4 * 38.518328893373322)
             + ((((t5 * -1.3581206122441249 + t6 * 29.509888285995231) - t7 * 35.875273533069631)
                 + K_result_tmp * 6.89319242137903)
                - b_K_result_tmp * 83.997723203541511))
            + ((((c_K_result_tmp * 67.489891732481766 + d_K_result_tmp * 67.7587501475345)
                 - e_K_result_tmp * 72.202271572623545)
                + f_K_result_tmp * 14.94907237319339)
               + 0.426380579431373);
        K_result[29] =
            (((((l_l * -3.4564175049273271 - l_r * 2.8998377043498329) + t2 * 3.9341691070930191)
               + t3 * 6.8941482393910869)
              - t4 * 22.95899407953609)
             + ((((t5 * 20.53769497924948 - t6 * 36.025499539084379) + t7 * 18.47372141377998)
                 - K_result_tmp * 13.55529297648641)
                - b_K_result_tmp * 12.09926055650894))
            + ((((c_K_result_tmp * 53.709465603232132 + d_K_result_tmp * 24.886483527707281)
                 + e_K_result_tmp * 27.31558305115016)
                - f_K_result_tmp * 65.45860269074997)
               + 0.37429283306853461);
        K_result[30] =
            (((((l_l * -9.6565031018839225 + l_r * 22.46623331639055) + t2 * 33.535209093237832)
               - t3 * 70.054736204326119)
              + t4 * 88.363856370153215)
             + ((((t5 * -79.463062013880091 + t6 * 87.9501050435872) + t7 * 33.580415923316309)
                 - K_result_tmp * 21.403960521334191)
                + b_K_result_tmp * 77.401455525504232))
            + ((((c_K_result_tmp * -297.50683047393392 + d_K_result_tmp * 41.411476255159577)
                 - e_K_result_tmp * 203.881334292463)
                + f_K_result_tmp * 273.94901210779261)
               + 0.13197911497832041);
        K_result[31] =
            (((((l_l * 24.98521763004219 - l_r * 2.406387638957264) - t2 * 132.00968755691991)
               + t3 * 308.50328620027989)
              - t4 * 270.01982466300223)
             + ((((t5 * 30.918646957157151 - t6 * 86.86839369021385) + t7 * 70.996646210221073)
                 - K_result_tmp * 3.0275374397098092)
                + b_K_result_tmp * 40.753968446558659))
            + ((((c_K_result_tmp * 23.724421961450911 - d_K_result_tmp * 49.46111118869301)
                 + e_K_result_tmp * 107.0432400303656)
                - f_K_result_tmp * 94.1927808093761)
               + 1.1410323176360571);
        K_result[32] =
            ((((((l_l * 607.53713413393325 - l_r * 696.2848371822729) - t2 * 1481.909295298899)
                + t3 * 771.28417173648961)
               + t4 * 653.58511153113011)
              + t5 * 4649.893859876287)
             + (((((t6 * -10198.934594286249 + t7 * 7524.6262842060669)
                   - K_result_tmp * 1803.8962667109561)
                  - b_K_result_tmp * 371.36760215984492)
                 + c_K_result_tmp * 3389.8025393428829)
                + d_K_result_tmp * 6256.5380716800692))
            + ((e_K_result_tmp * -4408.9658815096582 - f_K_result_tmp * 4173.7309837285793)
               - 58.828410836047311);
        K_result[33] =
            ((((((l_l * -653.62358004500493 + l_r * 557.5978482450646) + t2 * 4807.3614757648638)
                - t3 * 10480.149373651589)
               + t4 * 7704.6958238523712)
              - t5 * 606.40353516783262)
             + (((((t6 * -1454.7355302778581 + t7 * 2636.839410467765)
                   - K_result_tmp * 2814.0824663909061)
                  + b_K_result_tmp * 8541.1366494593258)
                 - c_K_result_tmp * 6538.1961562525667)
                - d_K_result_tmp * 157.1491500240777))
            + ((e_K_result_tmp * 3481.4038070772981 - f_K_result_tmp * 4334.5626868743384)
               - 58.174164936061928);
        K_result[34] =
            ((((((l_l * 1183.8346432291671 - l_r * 2654.290790420202) - t2 * 2635.9010415423509)
                - t3 * 1287.9984721500371)
               + t4 * 5735.6749771293626)
              + t5 * 4459.0681221568229)
             + (((((t6 * 3983.2381897822 - t7 * 10056.130412468839)
                   + K_result_tmp * 448.67823229709188)
                  - b_K_result_tmp * 12090.75441154277)
                 + c_K_result_tmp * 9151.2726429941231)
                + d_K_result_tmp * 10248.6786824896))
            + ((e_K_result_tmp * -13373.787410082219 + f_K_result_tmp * 4986.8373581834312)
               - 7.57255868874563);
        K_result[35] =
            ((((((l_l * -3351.3705772912549 + l_r * 1984.62856320945) + t2 * 9875.8191070780176)
                - t3 * 11830.95528127786)
               + t4 * 3489.0858320555872)
              - t5 * 7068.4015245379878)
             + (((((t6 * 7665.3833809610414 - t7 * 2949.4392326532789)
                   - K_result_tmp * 1201.8409809460941)
                  + b_K_result_tmp * 12974.60851081697)
                 - c_K_result_tmp * 6575.574460505457)
                - d_K_result_tmp * 6245.6128033243458))
            + ((e_K_result_tmp * 11824.819651184051 - f_K_result_tmp * 10900.22429865702)
               - 12.510139857385081);
        K_result[36] =
            (((((l_l * 36.0877702072119 - l_r * 30.580318122323579) - t2 * 101.638356062782)
               + t3 * 72.829249464794316)
              + t4 * 22.70019064939078)
             + ((((t5 * 203.89476900667071 - t6 * 404.672129286879) + t7 * 260.51444559800558)
                 - K_result_tmp * 90.157603500094766)
                - b_K_result_tmp * 132.9697388620219))
            + ((((c_K_result_tmp * 296.06988343834621 + d_K_result_tmp * 403.10214342362121)
                 - e_K_result_tmp * 313.25367762463378)
                - f_K_result_tmp * 200.96366946658051)
               - 2.707053077709038);
        K_result[37] =
            (((((l_l * -17.310111615595719 + l_r * 21.923227715916841) + t2 * 157.3147881714151)
               - t3 * 360.94549731649738)
              + t4 * 262.35701082560342)
             + ((((t5 * -8.69698923971202 - t6 * 107.9836556916003) + t7 * 139.57284078244061)
                 - K_result_tmp * 132.84274287187219)
                + b_K_result_tmp * 332.53059461138758))
            + ((((c_K_result_tmp * -173.8348184266973 + d_K_result_tmp * 68.460363779449423)
                 + e_K_result_tmp * 125.6388283139173)
                - f_K_result_tmp * 285.323977202314)
               - 2.629495660749217);
        K_result[38] =
            (((((l_l * 13.636902704442891 - l_r * 91.497385538597968) - t2 * 71.889304191408968)
               - t3 * 5.9134111513780248)
              + t4 * 168.72072699920389)
             + ((((t5 * 149.41072733500559 + t6 * 148.19191714789559) - t7 * 332.86042106760652)
                 + K_result_tmp * 209.91367021267271)
                - b_K_result_tmp * 825.57826428644466))
            + ((((c_K_result_tmp * 504.8685922059783 + d_K_result_tmp * 163.82363148595121)
                 - e_K_result_tmp * 520.06893433140851)
                + f_K_result_tmp * 554.1934582432765)
               + 3.7444836441482678);
        K_result[39] =
            (((((l_l * -79.482308974302569 + l_r * 0.88051189319374024) + t2 * 222.0089239157156)
               - t3 * 184.5611579248029)
              - t4 * 54.1993861076182)
             + ((((t5 * 78.814542616513108 - t6 * 417.95942198293739) + t7 * 468.20554173223428)
                 - K_result_tmp * 13.01893698462518)
                + b_K_result_tmp * 438.38586367721712))
            + ((((c_K_result_tmp * -307.11979965685009 - d_K_result_tmp * 350.89451154995533)
                 + e_K_result_tmp * 522.64203324908226)
                - f_K_result_tmp * 262.31647394030739)
               + 3.8682610522381911);

        gain_ = Eigen::Map<Eigen::Matrix<double, 4, 10, Eigen::ColMajor>>(K_result);
    }

    Eigen::Matrix<double, 4, 10> gain_;
};
} // namespace rmcs_core::controller::lqr
