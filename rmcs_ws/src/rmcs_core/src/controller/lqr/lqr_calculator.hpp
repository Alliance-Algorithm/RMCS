#include <cmath>
#include <eigen3/Eigen/Dense>

// Due to the nonlinear nature of the wheeled leg's kinematic model, the Jacobian matrix derived
// from its linearized kinematic equations becomes highly complex and verbose. Furthermore, since
// leg length varies, the Jacobian matrix also changes dynamically, making conventional LQR
// operations impractical. Therefore, calculations are first performed in MATLAB to obtain all gain
// matrices across the entire leg length range. Subsequently, a bivariate function of the left and
// right leg lengths is fitted to derive the gain matrix K.

namespace rmcs_core::controller::lqr {

class LqrCalculator {
public:
    LqrCalculator() = default;

    auto update(double l_l, double l_r) -> Eigen::Matrix<double, 4, 10> {
        calculate_fit_gain(l_l, l_r);
        return gain_;
    }

private:
    void calculate_fit_gain(double l_l, double l_r) {
        double K_result[40];

        double K_result_tmp;
        double b_K_result_tmp;
        double c_K_result_tmp;
        double d_K_result_tmp;
        double e_K_result_tmp;
        double f_K_result_tmp;
        double t2;
        double t3;
        double t4;
        double t5;
        double t6;
        double t7;

        //     This function was generated by the Symbolic Math Toolbox version 24.2.
        //     2025-11-13 22:44:20
        t2 = l_l * l_l;
        t3 = std::pow(l_l, 3.0);
        t5 = l_r * l_r;
        t6 = std::pow(l_r, 3.0);
        t4 = t2 * t2;
        t7 = t5 * t5;
        K_result_tmp = l_l * l_r;
        b_K_result_tmp = l_l * t5;
        c_K_result_tmp = l_l * t6;
        d_K_result_tmp = l_r * t2;
        e_K_result_tmp = l_r * t3;
        f_K_result_tmp = t2 * t5;
        K_result[0] =
            ((((((l_l * 65.742000232621649 - l_r * 164.16682583486471) - t2 * 52.381670299384247)
                - t3 * 386.2464616614821)
               + t4 * 542.26001657504969)
              + t5 * 392.11423826325591)
             + ((((t6 * 97.875583809753323 - t7 * 691.72153331253764)
                  - K_result_tmp * 20.138079062233381)
                 - b_K_result_tmp * 1657.812224997456)
                + c_K_result_tmp * 1985.3342273262449))
            + (((d_K_result_tmp * 1415.261073756446 - e_K_result_tmp * 1100.267333961333)
                - f_K_result_tmp * 373.0130513504314)
               + 0.62665696127003523);
        K_result[1] =
            ((((((l_l * -137.6782528259844 + l_r * 38.291917257296006) + t2 * 601.06706713336121)
                - t3 * 967.765443429392)
               + t4 * 463.649191705752)
              + t5 * 180.95650637985389)
             + ((((t6 * -578.14999435552363 + t7 * 391.957501942056)
                  - K_result_tmp * 465.45483092991282)
                 + b_K_result_tmp * 976.92640151459261)
                - c_K_result_tmp * 67.562213729824677))
            + (((d_K_result_tmp * 61.659385499165687 + e_K_result_tmp * 797.36074479286879)
                - f_K_result_tmp * 1256.302427350575)
               + 0.80890190594414357);
        K_result[2] =
            ((((((l_l * -58.936551645814767 + l_r * 100.43070443026269) + t2 * 134.7057987502493)
                - t3 * 171.715152262072)
               + t4 * 260.01877309025127)
              - t5 * 608.01436024643863)
             + (((((t6 * 1073.386058341245 - t7 * 334.41160739101912)
                   + K_result_tmp * 113.639816009988)
                  + b_K_result_tmp * 421.62514920632708)
                 - c_K_result_tmp * 1786.6435368411981)
                - d_K_result_tmp * 435.55944825783172))
            + ((e_K_result_tmp * -550.66675594008791 + f_K_result_tmp * 1643.2489674730241)
               + 10.79434735925515);
        K_result[3] =
            ((((((l_l * 17.470935993895338 + l_r * 50.831427775719263) - t2 * 687.4474700837809)
                + t3 * 2152.3857311851771)
               - t4 * 2023.7205507551851)
              - t5 * 625.1804360193164)
             + ((((t6 * 1253.250708378072 - t7 * 859.1228344233549)
                  + K_result_tmp * 805.83458525202445)
                 - b_K_result_tmp * 246.38589855911019)
                - c_K_result_tmp * 335.89539317621069))
            + (((d_K_result_tmp * -1942.114665231356 + e_K_result_tmp * 1309.7478537128129)
                + f_K_result_tmp * 884.74139025727879)
               + 9.13562076257349);
        K_result[4] =
            (((((l_l * 51.618765926331527 - l_r * 101.13738170798339) - t2 * 8.95708958199305)
               - t3 * 314.67475435008328)
              + t4 * 387.6334722914317)
             + ((((t5 * 261.89330760067128 + t6 * 29.258960918484082) - t7 * 430.22788200317518)
                 - K_result_tmp * 127.3840659524775)
                - b_K_result_tmp * 915.65481615560964))
            + ((((c_K_result_tmp * 1255.9332693258041 + d_K_result_tmp * 1037.1094349037769)
                 - e_K_result_tmp * 698.84642810472917)
                - f_K_result_tmp * 430.54673417571621)
               - 2.1515748989123931);
        K_result[5] =
            (((((l_l * -119.3609663914195 + l_r * 77.261236019827066) + t2 * 395.04190370737882)
               - t3 * 537.72615245148461)
              + t4 * 182.66443016706981)
             + ((((t5 * -198.7156378678909 + t6 * 418.64243536679629) - t7 * 480.36171209178849)
                 - K_result_tmp * 118.1955126585697)
                + b_K_result_tmp * 303.50802825084207))
            + ((((c_K_result_tmp * 275.56047258933432 - d_K_result_tmp * 226.41242349661471)
                 + e_K_result_tmp * 720.23624044046949)
                - f_K_result_tmp * 723.90438215562028)
               - 2.5296472311547742);
        K_result[6] =
            (((((l_l * -58.56170849808084 + l_r * 39.916737454873079) + t2 * 68.947989451313433)
               - t3 * 36.528448326658513)
              + t4 * 117.4406998564984)
             + (((((t5 * -325.777173508277 + t6 * 621.513686909637) - t7 * 159.79216027074841)
                  + K_result_tmp * 240.12099506453529)
                 - b_K_result_tmp * 82.581978326705723)
                - c_K_result_tmp * 1007.408302279198))
            + (((d_K_result_tmp * -407.37199710550118 - e_K_result_tmp * 400.58426030231459)
                + f_K_result_tmp * 1356.806219869289)
               + 11.944576963344529);
        K_result[7] =
            ((((((l_l * 40.361578166435663 - l_r * 41.942511122782122) - t2 * 585.48729241581793)
                + t3 * 1623.9865989528621)
               - t4 * 1435.968108924161)
              - t5 * 135.4895503768636)
             + ((((t6 * 339.70973345186269 - t7 * 244.15181963706041)
                  + K_result_tmp * 609.062295677131)
                 - b_K_result_tmp * 506.592857295121)
                + c_K_result_tmp * 124.65353222908691))
            + (((d_K_result_tmp * -1145.8936460038419 + e_K_result_tmp * 667.51865206944569)
                + f_K_result_tmp * 623.81296716252916)
               + 10.91385918044422);
        K_result[8] =
            (((((l_l * -10.14292967245026 + l_r * 19.510955097222649) + t2 * 63.688427354792381)
               - t3 * 126.7030263345557)
              + t4 * 90.019434614642108)
             + ((((t5 * -12.62910633624522 - t6 * 68.095117792740581) + t7 * 92.6100356329447)
                 - K_result_tmp * 64.0139294363693)
                + b_K_result_tmp * 179.84689623277129))
            + ((((c_K_result_tmp * -131.83732123625609 + d_K_result_tmp * 34.954651254795969)
                 + e_K_result_tmp * 10.54375820451925)
                - f_K_result_tmp * 79.4730085041239)
               - 2.782183870224511);
        K_result[9] =
            (((((l_l * -21.676879342448569 + l_r * 12.321226124105211) + t2 * 45.053038755393537)
               - t3 * 40.736498825878989)
              + t4 * 14.182293926652751)
             + ((((t5 * -54.233045925723118 + t6 * 96.923717117908481) - t7 * 41.0847809943677)
                 + K_result_tmp * 20.86964231983946)
                - b_K_result_tmp * 21.805525628883171))
            + ((((c_K_result_tmp * -73.703002934173924 - d_K_result_tmp * 48.205145186361243)
                 + e_K_result_tmp * 0.37164453769723782)
                + f_K_result_tmp * 110.0699205718546)
               + 2.7929967821710409);
        K_result[10] =
            (((((l_l * -6.8780348541810667 - l_r * 16.099961296316138) + t2 * 34.829152893578431)
               - t3 * 110.1446416680607)
              + t4 * 116.4556040715007)
             + ((((t5 * 66.4965947634005 - t6 * 67.1180404126167) + t7 * 0.22275801877981269)
                 - K_result_tmp * 28.765159166789282)
                - b_K_result_tmp * 102.0190546135326))
            + ((((c_K_result_tmp * 130.8600727825069 + d_K_result_tmp * 160.2637982055565)
                 - e_K_result_tmp * 155.37865024067131)
                - f_K_result_tmp * 8.093955982347282)
               - 3.2046817899359779);
        K_result[11] =
            (((((l_l * 22.023525789365639 + l_r * 2.3226842069266689) - t2 * 109.7742823693729)
               + t3 * 223.706876603369)
              - t4 * 182.1064429077538)
             + ((((t5 * -16.298544568580731 + t6 * 64.146476977234713) - t7 * 93.856384238343054)
                 + K_result_tmp * 46.885252027497913)
                - b_K_result_tmp * 119.386123646578))
            + ((((c_K_result_tmp * 179.52484051833181 - d_K_result_tmp * 37.095894231595892)
                 + e_K_result_tmp * 70.533519774817037)
                - f_K_result_tmp * 65.1655497798367)
               + 3.11156333830338);
        K_result[12] =
            (((((l_l * -6.0347124087155848 + l_r * 10.256338714606731) + t2 * 36.034487936211761)
               - t3 * 63.9608770978389)
              + t4 * 39.509679028783658)
             + ((((t5 * -5.0414487721761976 - t6 * 43.969340282364918) + t7 * 57.711832988519753)
                 - K_result_tmp * 34.056119963357752)
                + b_K_result_tmp * 109.2951827140096))
            + ((((c_K_result_tmp * -78.837922176786833 + d_K_result_tmp * 1.3934012016259609)
                 + e_K_result_tmp * 27.765227145899889)
                - f_K_result_tmp * 49.3863021069217)
               - 1.238124950078388);
        K_result[13] =
            (((((l_l * -10.714551320965811 + l_r * 6.8511821798768047) + t2 * 12.01790656654911)
               + t3 * 2.2127122543525761)
              - t4 * 8.0181093327580673)
             + ((((t5 * -40.302270522501743 + t6 * 88.415260482909858) - t7 * 60.325646830687759)
                 + K_result_tmp * 28.709721645369189)
                - b_K_result_tmp * 51.015910354347888))
            + ((((c_K_result_tmp * -5.0937792766477807 - d_K_result_tmp * 34.576148111107557)
                 - e_K_result_tmp * 3.785457234395825)
                + f_K_result_tmp * 72.4475588587211)
               + 1.222238411094988);
        K_result[14] =
            (((((l_l * -0.98229349452137571 - l_r * 11.72348070058845) + t2 * 5.9245692433909536)
               - t3 * 35.034102192476048)
              + t4 * 42.954840028608707)
             + ((((t5 * 50.073120095831833 - t6 * 70.907851635712859) + t7 * 27.953446951940919)
                 - K_result_tmp * 19.2867397771467)
                - b_K_result_tmp * 41.6406668283246))
            + ((((c_K_result_tmp * 69.243025367636363 + d_K_result_tmp * 90.719777052373544)
                 - e_K_result_tmp * 77.862567260434417)
                - f_K_result_tmp * 23.859736386417872)
               - 1.2622286836864891);
        K_result[15] =
            (((((l_l * 12.49202706521565 + l_r * 0.48242804319495131) - t2 * 50.637397892085311)
               + t3 * 85.099425101873862)
              - t4 * 59.2977455404037)
             + ((((t5 * 3.133871025887625 + t6 * 8.719689032169196) - t7 * 28.545856331239222)
                 + K_result_tmp * 9.704499714564653)
                - b_K_result_tmp * 67.055766513467))
            + ((((c_K_result_tmp * 102.2402656009333 + d_K_result_tmp * 31.282480931863091)
                 - e_K_result_tmp * 7.4954001635994079)
                - f_K_result_tmp * 44.9149716129839)
               + 1.24331399972177);
        K_result[16] =
            (((((l_l * 11.80021731015565 - l_r * 72.921640114139976) - t2 * 44.566015557682263)
               - t3 * 78.570378889585214)
              + t4 * 182.99527774593719)
             + ((((t5 * -60.682819229444988 + t6 * 704.14696546445816) - t7 * 828.47684708198051)
                 + K_result_tmp * 197.50068793180131)
                - b_K_result_tmp * 1177.897504958082))
            + ((((c_K_result_tmp * 938.34507403309215 + d_K_result_tmp * 426.965973056169)
                 - e_K_result_tmp * 560.60692284051106)
                + f_K_result_tmp * 347.9969568508659)
               + 1.803625058148816);
        K_result[17] =
            (((((l_l * -17.888453298326709 - l_r * 32.853034524878623) + t2 * 122.7775490392724)
               - t3 * 198.74621637453919)
              + t4 * 27.595960348631191)
             + (((((t5 * 278.12055552001408 - t6 * 515.30272840351313) + t7 * 242.2610324760027)
                  - K_result_tmp * 227.472493036576)
                 + b_K_result_tmp * 266.87686015907678)
                + c_K_result_tmp * 390.26919078295742))
            + (((d_K_result_tmp * 168.777011867226 + e_K_result_tmp * 396.2767322366152)
                - f_K_result_tmp * 874.39629365858411)
               + 1.1879488399098279);
        K_result[18] =
            (((((l_l * -28.445674224257161 + l_r * 133.1992896905158) + t2 * 55.1250721006242)
               - t3 * 9.127477406915542)
              + t4 * 30.864302634941609)
             + (((((t5 * -450.093388257261 + t6 * 615.42324342693928) - t7 * 69.2633438874434)
                  + K_result_tmp * 80.407025457619014)
                 + b_K_result_tmp * 312.69109226779511)
                - c_K_result_tmp * 1102.736261460343))
            + (((d_K_result_tmp * -374.10368958919719 - e_K_result_tmp * 121.7149564247612)
                + f_K_result_tmp * 863.39469234281091)
               - 1.96009566573998);
        K_result[19] =
            (((((l_l * 18.78880668336452 - l_r * 2.571667298988491) - t2 * 258.34664122577118)
               + t3 * 864.76966519815642)
              - t4 * 869.57534622032949)
             + ((((t5 * -258.44331430146428 + t6 * 377.55191135262658) - t7 * 191.7135178023396)
                 + K_result_tmp * 242.98508560433339)
                + b_K_result_tmp * 508.268432159587))
            + ((((c_K_result_tmp * -560.4897619157739 - d_K_result_tmp * 1061.8106963679541)
                 + e_K_result_tmp * 909.91716648345994)
                + f_K_result_tmp * 131.5914813453644)
               + 1.6391768009073691);
        K_result[20] =
            (((((l_l * 1.07983786439577 - l_r * 10.85618036361061) + t2 * 4.7358339031914536)
               - t3 * 34.514852987299847)
              + t4 * 40.764983995143439)
             + ((((t5 * 26.12298910332014 - t6 * 13.57931670210346) - t7 * 11.54685053771852)
                 - K_result_tmp * 1.6269455566548079)
                - b_K_result_tmp * 102.7027833408567))
            + ((((c_K_result_tmp * 91.770348703220975 + d_K_result_tmp * 89.207170899830118)
                 - e_K_result_tmp * 79.931486153081309)
                + f_K_result_tmp * 6.7521077655079376)
               + 0.0025908774155117271);
        K_result[21] =
            (((((l_l * -2.6496231970894191 + l_r * 3.6017440706653381) + t2 * 7.8617729919378752)
               + t3 * 5.7342237019208291)
              - t4 * 28.61456510643778)
             + ((((t5 * 4.0149967654720964 - t6 * 16.666913064436219) + t7 * 10.130713027105751)
                 - K_result_tmp * 32.792294304764937)
                + b_K_result_tmp * 69.573733050802574))
            + ((((c_K_result_tmp * -1.066120573218639 - d_K_result_tmp * 5.2876177445718344)
                 + e_K_result_tmp * 75.295254409004713)
                - f_K_result_tmp * 102.6000526130947)
               - 0.1041166910682552);
        K_result[22] =
            (((((l_l * -1.902702025435336 + l_r * 9.0335048779233453) - t2 * 3.375142801075008)
               + t3 * 13.065553621697561)
              + t4 * 0.96593307394933925)
             + ((((t5 * -45.982059498839661 + t6 * 105.1023659282083) - t7 * 53.227488625637832)
                 + K_result_tmp * 9.6441441714189047)
                + b_K_result_tmp * 4.4540686649446579))
            + ((((c_K_result_tmp * -121.27470177917959 - d_K_result_tmp * 21.4496511806005)
                 - e_K_result_tmp * 56.922388789445847)
                + f_K_result_tmp * 140.14209389526241)
               + 0.74742646741770979);
        K_result[23] =
            (((((l_l * 6.7117464679656473 - l_r * 5.5193433696722964) - t2 * 57.702151660228573)
               + t3 * 155.494968036898)
              - t4 * 141.534067840227)
             + ((((t5 * -15.09975616056647 + t6 * 27.877725762457459) - t7 * 29.852453414222211)
                 + K_result_tmp * 71.348557470119147)
                - b_K_result_tmp * 35.895772934463267))
            + ((((c_K_result_tmp * 30.005199399353721 - d_K_result_tmp * 162.25347557148271)
                 + e_K_result_tmp * 126.39625164423541)
                + f_K_result_tmp * 37.887711347213482)
               + 0.097399914303206075);
        K_result[24] =
            (((((l_l * 7.70073388030568 - l_r * 63.100221178070427) - t2 * 42.877327064547)
               - t3 * 38.4557022086672)
              + t4 * 148.87403977509661)
             + (((((t5 * -41.18911635088039 + t6 * 324.13808597207509) - t7 * 378.27955922157179)
                  + K_result_tmp * 289.06912083291542)
                 - b_K_result_tmp * 703.52215034804158)
                + c_K_result_tmp * 447.767897697821))
            + (((d_K_result_tmp * 57.978454542837071 - e_K_result_tmp * 367.21431953613057)
                + f_K_result_tmp * 403.45336928732809)
               + 1.374175360254855);
        K_result[25] =
            (((((l_l * -34.271583878074168 - l_r * 29.913461143979561) + t2 * 224.19402546780739)
               - t3 * 577.62094264252391)
              + t4 * 502.25124692438709)
             + ((((t5 * 155.78495563762749 - t6 * 258.48412888852408) + t7 * 160.0800391231009)
                 - K_result_tmp * 276.58644176442073)
                - b_K_result_tmp * 85.252780026231719))
            + ((((c_K_result_tmp * 203.49175400523029 + d_K_result_tmp * 783.76146947832626)
                 - e_K_result_tmp * 547.34695858930672)
                - f_K_result_tmp * 241.29651092478079)
               + 2.07433587994801);
        K_result[26] =
            (((((l_l * -32.979566290220269 + l_r * 41.04746633958591) + t2 * 121.2972867871816)
               - t3 * 165.1175272875835)
              + t4 * 120.3412976409259)
             + ((((t5 * -247.11022974725549 + t6 * 193.8453578504097) + t7 * 66.108292240088318)
                 - K_result_tmp * 105.10267134404209)
                + b_K_result_tmp * 767.29896191758928))
            + ((((c_K_result_tmp * -823.89125859187141 - d_K_result_tmp * 199.29290253184371)
                 + e_K_result_tmp * 60.863480529475737)
                + f_K_result_tmp * 63.7339163475523)
               + 2.1718492070851041);
        K_result[27] =
            ((((((l_l * 38.456927557669012 + l_r * 81.7260725318992) - t2 * 309.28313282821739)
                + t3 * 915.01988327380718)
               - t4 * 903.37988553500691)
              - t5 * 58.265221403698348)
             + ((((t6 * 50.832569529983488 + t7 * 36.462534269965722)
                  - K_result_tmp * 33.186333302981957)
                 + b_K_result_tmp * 103.59863126837951)
                - c_K_result_tmp * 233.80049506267329))
            + (((d_K_result_tmp * -327.7715140418897 + e_K_result_tmp * 411.940426952421)
                + f_K_result_tmp * 132.4570946986926)
               - 2.8976996017412531);
        K_result[28] =
            (((((l_l * 3.4947139055562189 - l_r * 2.8762091187738559) - t2 * 6.9559169859923893)
               - t3 * 14.72910312548712)
              + t4 * 32.293937674470307)
             + ((((t5 * -30.532879193449141 + t6 * 110.6611830556341) - t7 * 107.3996861918399)
                 + K_result_tmp * 19.1563631472269)
                - b_K_result_tmp * 118.4010600812998))
            + ((((c_K_result_tmp * 74.124175872787333 + d_K_result_tmp * 68.61937763112806)
                 - e_K_result_tmp * 93.730726689404065)
                + f_K_result_tmp * 54.701802340110021)
               - 0.095369362848991793);
        K_result[29] =
            (((((l_l * -8.9520651627639527 - l_r * 0.17863115794247009) + t2 * 36.794761124293309)
               - t3 * 67.982046941977146)
              + t4 * 38.361112332731089)
             + ((((t5 * 5.7870457692441759 + t6 * 19.440243364683951) - t7 * 42.880578263950952)
                 - K_result_tmp * 17.2861068745997)
                - b_K_result_tmp * 43.929952294540293))
            + ((((c_K_result_tmp * 95.026585666370252 + d_K_result_tmp * 40.371332021670732)
                 + e_K_result_tmp * 23.70081960655245)
                - f_K_result_tmp * 74.300378821324685)
               - 0.030843619913440531);
        K_result[30] =
            (((((l_l * -8.3708331033036352 + l_r * 7.5156256422416634) + t2 * 23.093414882983371)
               - t3 * 27.864687284415229)
              + t4 * 22.877963575065589)
             + ((((t5 * -12.965862943889871 - t6 * 24.791983789362181) + t7 * 70.6777074129471)
                 - K_result_tmp * 0.71903852590290274)
                + b_K_result_tmp * 63.651976625924107))
            + ((((c_K_result_tmp * -139.5291109794579 - d_K_result_tmp * 49.29458563771324)
                 - e_K_result_tmp * 12.05622901625731)
                + f_K_result_tmp * 98.436392990512758)
               + 0.22966749250505389);
        K_result[31] =
            (((((l_l * 3.176755727085248 + l_r * 5.1076007224127471) - t2 * 44.906252850069578)
               + t3 * 144.3968751091314)
              - t4 * 147.06084439492491)
             + ((((t5 * -26.48236655128424 + t6 * 19.628061747036789) - t7 * 0.56906371336675921)
                 + K_result_tmp * 25.01184753100198)
                + b_K_result_tmp * 71.93443352924966))
            + ((((c_K_result_tmp * -46.2074855104563 - d_K_result_tmp * 119.4531974180299)
                 + e_K_result_tmp * 133.14416085501631)
                - f_K_result_tmp * 41.812868518699233)
               + 0.68308102771958357);
        K_result[32] =
            (((((l_l * 50.879352779123387 + l_r * 28.194123394531889) - t2 * 179.17147687860131)
               + t3 * 335.8254768437061)
              - t4 * 255.96761923728531)
             + ((((t5 * -13.940709611916819 - t6 * 89.8770543394501) + t7 * 94.728603839377982)
                 + K_result_tmp * 19.054275951961959)
                - b_K_result_tmp * 34.3976853249082))
            + ((((c_K_result_tmp * 148.75291971412329 - d_K_result_tmp * 11.180862497058589)
                 + e_K_result_tmp * 57.265316055825437)
                - f_K_result_tmp * 135.6413818102948)
               - 20.172356813422681);
        K_result[33] =
            (((((l_l * 41.725434886435508 + l_r * 30.947724523191251) + t2 * 65.469048699201679)
               - t3 * 445.59273353881468)
              + t4 * 536.86429878402407)
             + ((((t5 * 21.104942768016031 - t6 * 69.667024191408359) + t7 * 87.138961079062327)
                 - K_result_tmp * 225.29814265883419)
                + b_K_result_tmp * 89.575132174286665))
            + ((((c_K_result_tmp * -158.81970858425419 + d_K_result_tmp * 547.9641799270081)
                 - e_K_result_tmp * 564.18274613860012)
                + f_K_result_tmp * 67.1685069442193)
               - 19.79082845756766);
        K_result[34] =
            ((((((l_l * 91.513990141990732 - l_r * 268.96214357902733) - t2 * 371.596573631106)
                + t3 * 677.82105811918188)
               - t4 * 465.47011003702318)
              + t5 * 953.40595570907612)
             + ((((t6 * -1764.92023062041 + t7 * 1356.2015535350381)
                  + K_result_tmp * 84.348385930053709)
                 - b_K_result_tmp * 76.4317576112754)
                - c_K_result_tmp * 143.2514639033121))
            + (((d_K_result_tmp * -74.915655701766312 - e_K_result_tmp * 79.63131178704613)
                + f_K_result_tmp * 244.2021163096536)
               - 21.102831555636691);
        K_result[35] =
            ((((((l_l * -296.87998316188322 + l_r * 126.58401117224869) + t2 * 1115.194104751552)
                - t3 * 1983.1793019098129)
               + t4 * 1331.6403747020131)
              - t5 * 488.45285285093939)
             + ((((t6 * 818.203627871081 - t7 * 596.73174649167709)
                  - K_result_tmp * 4.5910207918667192)
                 + b_K_result_tmp * 340.31150206254563)
                - c_K_result_tmp * 44.069124590005067))
            + (((d_K_result_tmp * -305.7515288221918 + e_K_result_tmp * 594.9891156093762)
                - f_K_result_tmp * 466.193593561064)
               - 21.47495663926485);
        K_result[36] =
            (((((l_l * 11.392511706212719 - l_r * 0.019919442643399139) - t2 * 33.036000568074464)
               + t3 * 45.229888787307459)
              - t4 * 25.83122067217786)
             + ((((t5 * 16.0588020701805 - t6 * 34.77543439033996) + t7 * 16.989606928881919)
                 - K_result_tmp * 11.56065095113656)
                - b_K_result_tmp * 18.48752355406614))
            + ((((c_K_result_tmp * 53.984020765081333 + d_K_result_tmp * 48.610017472052647)
                 - e_K_result_tmp * 26.847077236222429)
                - f_K_result_tmp * 43.117210202465273)
               - 2.80096795627845);
        K_result[37] =
            (((((l_l * 1.01868813668573 + l_r * 9.7678472261414786) + t2 * 26.76988568651274)
               - t3 * 82.6997890765413)
              + t4 * 78.323925407915524)
             + ((((t5 * -18.764544497852341 + t6 * 23.7069928773335) - t7 * 10.29607919916687)
                 - K_result_tmp * 33.450195169068948)
                + b_K_result_tmp * 46.312109913360793))
            + ((((c_K_result_tmp * -42.248576904462567 + d_K_result_tmp * 46.837783829110229)
                 - e_K_result_tmp * 35.978866730761993)
                - f_K_result_tmp * 10.2048920756438)
               - 2.7648775417528082);
        K_result[38] =
            (((((l_l * 5.3394416391660284 - l_r * 30.305337343897559) - t2 * 30.916161492834991)
               + t3 * 66.423979189730787)
              - t4 * 47.586725416788049)
             + ((((t5 * 89.827930646733819 - t6 * 149.86163683193411) + t7 * 114.8244343538348)
                 + K_result_tmp * 35.053067473828122)
                - b_K_result_tmp * 39.908343172898817))
            + ((((c_K_result_tmp * -19.72862085458355 - d_K_result_tmp * 52.955773659738348)
                 + e_K_result_tmp * 4.9336162031679249)
                + f_K_result_tmp * 78.971143997122454)
               - 1.784280298872104);
        K_result[39] =
            (((((l_l * -33.840444163836992 + l_r * 10.12146590899663) + t2 * 106.1588170712585)
               - t3 * 165.62368999517739)
              + t4 * 101.0068447724255)
             + ((((t5 * -47.854596393644528 + t6 * 93.337432454580949) - t7 * 73.1422620631561)
                 + K_result_tmp * 28.202553361804579)
                - b_K_result_tmp * 19.579641636014081))
            + ((((c_K_result_tmp * 20.28076139526188 - d_K_result_tmp * 66.326812404169672)
                 + e_K_result_tmp * 64.8711496264674)
                + f_K_result_tmp * 2.9656492393058351)
               - 1.853469249301628);

        gain_ = Eigen::Map<Eigen::Matrix<double, 4, 10, Eigen::ColMajor>>(K_result);
    }

    Eigen::Matrix<double, 4, 10> gain_;
};
} // namespace rmcs_core::controller::lqr